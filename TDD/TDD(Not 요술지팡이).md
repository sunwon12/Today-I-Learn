이 글을 쓰는 이유는 인터넷에 TDD의 장점, TDD 기법은 많이 있습니다. 그러나 가슴에 와닿는 왜 써야 하는지는 찾아보기 힘들었기 때문입니다. 미리 말하지만, TDD를 사용한다고 좋은(객체지향적인) 코드가 뚝딱 나오지는 않습니다. TDD의 창시자인 켄터 벡도 말하듯이 **TDD는 요술 지팡이가 아닙니다**. 단순 테스트를 먼저 짬으로써 어떤 게 극적으로 달라지겠습니까.

기계적으로 테스트 코드 작성 후 실제 코드를 구현하는 프로세스를 반복하는 TDD는 아무 의미없습니다. 비유를 들자면, 자전거 타는 법을 배울 때, 단순히 페달만 밟는 것과 중심을 잡으며 페달을 밟는 것은 다릅니다. TDD도 마찬가지입니다. 테스트 코드를 먼저 작성하는 행위만 반복하는 것은 페달만 맹목적으로 밟는 것과 같고, TDD의 본질을 이해하고 실천하는 것은 중심을 잡으며 자전거를 타는 것과 같습니다. 

그래서 TDD의 본질이 뭔데?

 **`TDD의 본질은 결정과 피드백의 갭을 줄이는 것입니다.`** 

 “어떻게 해야지 피드백을 자주 받을 수 있을까?(아기 걸음마)”, “어떻게 해야지 값싸게 피드백을 받을까?” 를 생각하면서 TDD를 하면 잘 적응할 수 있을 것입니다.

**`처음부터 개발을 잘한다면 TDD가 필요없습니다.`** 프로그램을 어떻게 구현해야 할지 명확하다면 TDD가 필요없습니다. 어떻게 개발해야 하는지 불확실할 때, TDD를 사용하면 됩니다.

TDD = **`켄터 벡의 좋은 코드 작성을 위한 원칙`** +  테스트 코드의 장점 + 테스트 코드를 먼저 작성`(행위로서의 장점)`

TDD의 오버헤드를 감수하기 싫어 TDD를 도입하기 싫으신 분들은 **`켄터 벡의 좋은 코드 작성를 위한 원칙` 만을 뽑아가길 권장합니다.** 사실 켄터 벡이 직접적으로 좋은 코드 작성을 위한 원칙이라고 말하지는 않습니다. TDD를 수행하기 위한 방법이라고 말하지만, 저는 이것들이 TDD에 국한되지 않고 좋은 코드 작성을 위한 원칙이라고 생각합니다. **TDD를 안 하더라도 이 원칙들을 수행할 수 있기 때문입니다.**

---

## **📐켄터 벡의 좋은 코드 작성을 위한 원칙**

1. **Baby Steps (아기 걸음마)**
- 작은 단위로 점진적 진행
- "한 번에 너무 많은 것을 하지 마라"
- 각 단계가 이해하기 쉽고 되돌리기 쉬워야 함

1. **You Aren't Gonna Need It (YAGNI)**
- 필요할 것 같은 기능이 아닌, **현재 필요한 기능만 구현**
    - 현재 필요한 기능만 구현이라고 하면 두가지로 나눌 수 있을 것 같습니다. **(개인적인 생각)**
        1. **요구사항 관점: 현재 요구사항에서만 나와있는 기능만 구현**
        2. 테스트 관점: 내가 테스트하고 있는 기능만 구현  ← TDD에서 말하는 YAGNI
- 미래를 위한 과도한 설계 지양
    - ex) 모든 것은 다 변경 가능성이 있으니까 모두 다 interface를 만들어야지 (X)
- 현재 요구사항에 집중
- 과도한 추상화 지양

**TDD에서 말하는 YAGNI(개인적인 생각)**

```java
// 1. 실패하는 테스트
@Test
void 로또_번호_검증() {
    assertThatThrownBy(() -> new LottoNumber(46))
        .isInstanceOf(IllegalArgumentException.class);
}

// 2. 빠른 피드백을 위한 최소 구현
public class LottoNumber {
    public LottoNumber(int number) {
        if (number > 45) throw new IllegalArgumentException();
    }
}

// 3. 다음 테스트
@Test
void 로또_번호_최소값_검증() {
    assertThatThrownBy(() -> new LottoNumber(0))
        .isInstanceOf(IllegalArgumentException.class);
}

// 4. 리팩토링
public class LottoNumber {
    public LottoNumber(int number) {
        if (number > 45 || number < 1) throw new IllegalArgumentException();
    }
}

// 5. 리팩토링2
public class LottoNumber {
    public LottoNumber(int number) {
        validateRange(number);
    }
    
    private validateRange(int number) {
        if (number > 45 || number < 1) throw new IllegalArgumentException();
    }
}

```

1. **Clean Code That Works**
- 동작하는 깨끗한 코드가 목표
- 작동하지만 깨끗하지 않은 코드는 기술 부채
- 깨끗하지만 작동하지 않는 코드는 쓸모없음

1. **Do The Simplest Thing That Could Possibly Work**
- 제대로 돌아가는 가장 간단한 것부터 시도하라

---

# **🥸 개인적으로 TDD를 사용하는 이유**

## **종이 대신 테스트 코드(행위에 의한 장점)**

대부분 설계, 구현에 대해 어느 정도 구상을 해놓고 코드를 짤 것입니다. 생각을 생각으로 끝내지 않고 문서를 작성하는 겁니다. 문서를 죽을 수도 있는 문서(종이)로 작성하는 대신 살아있는 문서(테스트 코드)로 작성하는 겁니다.  단지, 생각을 정리하기 위함이었는데 TDD를 실천하는 것이죠.

## 테스트 코드 강제화**(행위에 의한 장점)**

저는 실제로 코드를 다 짜고 나면 쾌감과 함께 탈력감을 느낍니다. 테스트 코드를 짜야 한다는 생각은 들지만, 테스트가 귀찮은 대상으로 여겨집니다. 실제로 종종 이 감정이 테스트를 등한시하는 결과로 이어지기도 했습니다. 그러나 테스트 코드를 먼저 짬으로서 이러한 사태를 예방해줍니다.

## **작은 스텝, 한가지에 집중하며 나아가기 인식**(**켄터 벡의 좋은 코드 작성을 위한 원칙에 의한 장점)**

저는 이것이 TDD를 사용하는 가장 큰 이유입니다. 물론 이건 행위에 의한 장점이 아니기 때문에 굳이 테스트 코드를 먼저 작성하지 않아도 됩니다. 그래도 테스트 코드를 먼저 작성함으로써 이 생각을 한 번 더 인지하고 들어가는 겁니다. 

원래 저는 리팩토링을 하거나, 코드 구현할 때 눈에 보이는거, 그 때 생각나는 것들을 가지치기 형태로 작업을 진행했습니다. 그러다 어느 하나가 삐끗하면 생각의 꼬리를 잃게 되고 오랫동안 컴파일 에러를 안고 있는 프로그램을 가지며 개발했었습니다.

그러나, 켄터 벡의 TDD책을 접하게 되었고, 저의 모난 부분을 꼬집어주었습니다. 한참을 나를 과대평가 했구나..힐링 에세이 책을 읽은 거와 같이 나를 바라보게 되고 개발 태도를 개선하게 되었습니다. 더는 한 번에 많은 시도를 하지 않고 TDD원칙 대로 `아기 걸음마` 로 점진적으로 나아가게 됐습니다.

## 좋은 코드 강제화(행위에 의한 장점)

좋은 코드가 테스트하기 좋은 코드는 아니지만, 테스트하기 좋은 코드는 좋은 코드입니다. 어떤 걸 반환해야 할지, 어떤 객체와 협력해야할지, 테스트 코드를 먼저 작성하면서 인터페이스와 협력 객체들을 고민하게 됩니다. 이 과정에서 코드의 구조와 설계에 대한 깊은 고민이 이루어지게 됩니다`(생각의 여지 제공)`. 

만약 테스트 코드 작성 후 구현 과정에서 테스트 코드대로 검증하기 어려운 경우가 발생한다면, 이는 구현 코드를 리팩토링하도록 강제합니다.

```java
// 구현 먼저 할 때 흔히 발생하는 상황
public class LottoService {
   public boolean checkWin(List<Integer> userNumbers, List<Integer> winningNumbers, int bonusNumber) {
       // 1. 우선 당첨 확인에 필요한 파라미터들 나열
       // 2. 구현하다가 "아, 보너스 번호도 필요하네" 하고 매개변수 추가
   }
}

// 테스트 먼저 작성할 때
@Test
void 로또_당첨_확인_테스트() {
   // 1. "당첨 확인 기능을 어떻게 사용하면 좋을까?" 먼저 고민
   Lotto lotto = new Lotto(Arrays.asList(1, 2, 3, 4, 5, 6));
   WinningNumbers winningNumbers = new WinningNumbers(
       Arrays.asList(1, 2, 3, 4, 5, 6), 
       7
   );
           
   Rank rank = lotto.matchWith(winningNumbers);
   // 2. 도메인 객체들과 깔끔한 인터페이스가 먼저 도출됨
}
```

---

# TDD에 관해 읽어보면 좋을 컨텐츠들

[심심할 때 틀어놓으면 좋은 TDD에 관한 팟캐스트](https://www.podbbang.com/channels/14757/episodes/22396860)

[TDD 반대](https://www.moreagile.net/2014/08/IsTDDdead3.html)

[TDD 기법 소개](https://mangkyu.tistory.com/182)
